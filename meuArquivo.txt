const nomeJogador = document.getElementById("nome_add");
const nomesAdicionados = document.querySelector(".adicionados");
const timesSorteados = document.querySelector('.times_sorteados');
const sectionFora = document.querySelector('.nomesFora');

const arrayNomes = [];

// Função para adicionar jogador
function adicionarJogador() {
    const nome = nomeJogador.value;

    function ajustarNome(n) {
        return n.charAt(0).toUpperCase() + n.slice(1);
    }

    if (!nome.trim()) {
        alert("Preencha os campos corretamente!");
        nomeJogador.value = "";
        return;
    }

    const p = document.createElement('p');
    p.textContent = ajustarNome(nome);
    let img = new Image();
    img.src = 'img/delete.png';

    p.appendChild(img);
    nomesAdicionados.appendChild(p);

    arrayNomes.push(nome);
    console.log(arrayNomes);
    nomeJogador.value = "";

    img.addEventListener('click', () => {
        p.remove();
    });
}

// Função para sortear times
function sortearTimes(qtdTimes) {
    if (arrayNomes.length === 0) {
        alert('Nenhum jogador foi adicionado!');
        return;
    }

    const arrayEmbaralhado = [...arrayNomes].sort(() => Math.random() - 0.5);
    const quantidade = Math.floor(arrayEmbaralhado.length / qtdTimes);

    timesSorteados.style.display = 'block';
    timesSorteados.classList.add('times_sorteados');
    const divTime = document.createElement('div');
    divTime.classList.add('container_sorteados');

    for (let i = 1; i <= qtdTimes; i++) {
        const tituloTime = document.createElement('h2');
        tituloTime.textContent = `Time ${i}`;
        const listaTime = document.createElement('ol');
        listaTime.appendChild(tituloTime);

        divTime.appendChild(listaTime);
        timesSorteados.appendChild(divTime);

        for (let n = 1; n <= quantidade; n++) {
            const itemLista = document.createElement('li');
            itemLista.textContent = `${n}. ${arrayEmbaralhado.shift()}`;
            listaTime.appendChild(itemLista);
        }
    }

    // corrigindo bug: estava "time" (não definido), agora usa qtdTimes
    let sobrou = arrayEmbaralhado.length % qtdTimes;
    console.log(sobrou);
    if (sobrou) {
        document.querySelector('.jogadores_fora').style.display = 'block';
        document.querySelector('.titulo_fora').textContent = `Jogadores de fora [${sobrou}]`;
        const jogadoresFora = document.createElement('p');
        jogadoresFora.textContent = arrayEmbaralhado.join(', ');
        sectionFora.appendChild(jogadoresFora);
    }
}

// Eventos dos botões
const btnAdicionar = document.getElementById("adicionar");
const btnSorteio = document.getElementById("sortear");

btnAdicionar.addEventListener('click', adicionarJogador);

btnSorteio.addEventListener('click', () => {
    const times = parseInt(document.getElementById('quantidade').value);
    if (!isNaN(times) && times > 0) {
        sortearTimes(times);
    } else {
        alert("Digite uma quantidade válida de times.");
    }
});
